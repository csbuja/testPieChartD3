<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Testing D3</title>

        <script src='http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js'> </script>
        <script src="http://d3js.org/d3.v3.min.js"></script>
        <script src='http://cdnjs.cloudflare.com/ajax/libs/seedrandom/2.3.6/seedrandom.min.js'></script>
        <!--<script type="text/javascript" src="d3/d3.js"></script>-->
        <style>
        </style>
    </head>
    <body>
        <script type="text/javascript">
        	$(document).ready(function(){
              Math.seedrandom('hello.');
              var numSections = 6;
              var jobs_colors = getRandomColors(numSections);  var jobs_colors = getRandomColors(numSections);


            
              var innerRadius = 0;
              var outerRadius = 130;
              var width       = 800;
              var height      = 500;

              
              var textArray = ['name1', 'name2', 'name3', 'name4', 'name5', 'name6'];


              var pie = d3.layout.pie()
                                 .sort(null);
                   
              var arc = d3.svg.arc()
                              .innerRadius(innerRadius)
                              .outerRadius(outerRadius);

              var svg = d3.select("body").append("svg")
                                         .attr("width", width)
                                         .attr("height", height)
                                         .append("g")
                                         .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");
              //  function makePieChart(){
              var arcgroup = svg.selectAll("svg").data(pie(arrayOfOnes(numSections)))
                          .enter().append('g')

              var path = arcgroup.append("path")
                         .attr("fill", "#fff")
                         .attr("d", arc)
                         .each(function(d) { this._current = d; }); // store the initial values

              var slicelabels = arcgroup.append('text')
                                .attr("transform", function(d) {                    //set the label's origin to the center of the arc
                                  //we have to make sure to set these before calling arc.centroid
                                  d.innerRadius = 0;
                                  d.outerRadius = 240;
                                  return "translate(" + arc.centroid(d) + ")";        //this gives us a pair of coordinates like [50, 50]
                                })
                                .text('hahaha');

              /*svg.selectAll('text').data(textArray)
                        .append('svg:text')
                        .attr('fill', 'red')
                        .attr('font-size', '20px');
                        .text(function(d,i){textArray[i];})*/
              $(svg).on("monitor", {svg:svg, arc:arc, pie:pie, jobs_colors:jobs_colors, numSections: numSections}, worker);


              //makePieChart();
              $(svg).trigger("monitor");

              function worker(event) {
                  var svg = event.data.svg;
                  var arc  = event.data.arc;
                  var pie  = event.data.pie;
                  var jobs_colors = event.data.jobs_colors;
                  var numSections = event.data.numSections;


                  var jobs_counts = getRandomCounts(numSections);
                  
                  /*console.log(jobs_counts)
                  var sum = 0;
                  $(jobs_counts).each(function(i,value){
                    sum+=value; 
                  });
                  console.log('sum: ' + sum); */

                  path = path.data(pie(jobs_counts))
                             .attr("fill", function(d,i) {return jobs_colors[i]})
                  path.transition().duration(750).attrTween("d", arcTween); // redraw the arcs
                                                                                                 
                  setTimeout(function(){$(svg).trigger("monitor")}, 1000)
              }
                                      
              // Store the displayed angles in _current.
              // Then, interpolate from _current to the new angles.
              // During the transition, _current is updated in-place by d3.interpolate.
              function arcTween(a) {
                var i = d3.interpolate(this._current, a);
                this._current = i(0);
                return function(t) {
                  return arc(i(t));
                };
              }



              function addRandomColor(list){
                  list.push('#'+Math.floor(Math.random()*16777215).toString(16));
              }            

              //takes in a numberOfColors
              //returns an Array of Random Colors if
              function getRandomColors(numColors){
                  console.log('called')
                  if(numColors<0){
                      throw{
                          error: 'Error'   ,
                          msg: 'numColors in the getRandomColors can\'t be negative'
                      }
                  }
                  else{
                    console.log('teets')
                    var theArray = [] ;
                    for(var i = 0; i< numColors; ++i)
                    {
                      addRandomColor(theArray); 
                     
                    }
                    return theArray;
                  }
              }

              function getRandomCounts(numSections) {
                  var arr = [];
                  for (var i=0;i<numSections;i++) {
                     arr.push(Math.floor(Math.random()*10)+1);
                  }
                  return (arr);
              }     
              function arrayOfOnes(numSections){
                return Array.apply(null, new Array(numSections)).map(Number.prototype.valueOf,1);    
              }

        	});
            
            


        </script>
    </body>
</html>